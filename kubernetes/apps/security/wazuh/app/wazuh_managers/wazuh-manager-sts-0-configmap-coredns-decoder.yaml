---
apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns-decoder
  namespace: security
data:
  coredns_decoder.xml: |
    <!-- CoreDNS decoder for Kubernetes pod log format -->
    <!-- Parent decoder (kubernetes-container) strips K8s metadata and extracts log field -->
    <!-- This decoder processes the log field to extract DNS query domain -->
    <!-- Wazuh only supports TWO-level hierarchy, cannot have grandchild decoders -->

    <decoder name="coredns-k8s">
      <parent>kubernetes-container</parent>
      <prematch>INFO</prematch>
      <regex>INFO.*IN ([a-zA-Z0-9.-]*)\.</regex>
      <order>dstdomain</order>
    </decoder>

<!-- CoreDNS decoder for Kubernetes pod log format -->
<!-- Parent decoder (kubernetes-container) strips K8s metadata -->
<!-- This decoder processes the extracted log field -->
<!-- prematch uses simple pattern matching only -->

<decoder name="coredns-k8s">
  <parent>kubernetes-container</parent>
  <prematch>^\[INFO\] </prematch>
</decoder>

<decoder name="coredns-k8s-query">
  <parent>coredns-k8s</parent>
  <regex offset="after_parent">^([^ ]+ IN [^ ]+\. [A-Za-z0-9][A-Za-z0-9]*)</regex>
  <order>url</order>
</decoder>

<decoder name="coredns-k8s-querytype">
  <parent>coredns-k8s</parent>
  <regex offset="after_parent">^([^ ]+) IN</regex>
  <order>protocol</order>
</decoder>

<decoder name="coredns-k8s-domain">
  <parent>coredns-k8s</parent>
  <regex offset="after_parent">IN ([^ ]+)\.</regex>
  <order>dstdomain</order>
</decoder>

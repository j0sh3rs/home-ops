---
date: 2026-01-05T19:36:54+0000
session_name: platform-evolution
researcher: Claude
git_commit: 312a01fc3ce47c5b37a33e98125795de3238be51
branch: main
repository: home-ops
topic: "Phase 4: Tetragon Runtime Security Deployment"
tags: [tetragon, security, ebpf, phase4]
status: complete
last_updated: 2026-01-05
last_updated_by: Claude
type: implementation_strategy
---

# Handoff: Phase 4 Tetragon Deployment Configuration Complete

## Task(s)

Phase 4: Tetragon Deployment - **Configuration Complete, Testing Pending**

Reference: thoughts/ledgers/CONTINUITY_CLAUDE-platform-evolution.md

Completed:
- ✅ Cilium Helm repo + Flux integration
- ✅ Tetragon v1.6.0 HelmRelease (128-512Mi memory)
- ✅ 3 TracingPolicies (sensitive-files, network-egress, privilege-escalation)
- ✅ Prometheus ServiceMonitor
- ✅ Documentation (claudedocs/tetragon-deployment.md)

Pending:
- ⏳ Git commit + push
- ⏳ Verify pod deployment
- ⏳ Test event generation
- ⏳ Validate metrics collection

## Critical References

1. thoughts/ledgers/CONTINUITY_CLAUDE-platform-evolution.md
2. claudedocs/tetragon-deployment.md
3. claudedocs/victorialogs-phase2-3-completion-summary.md

## Recent Changes

Created files:
- kubernetes/flux/meta/repos/cilium.yaml
- kubernetes/apps/security/tetragon/ks.yaml
- kubernetes/apps/security/tetragon/app/helmrelease.yaml
- kubernetes/apps/security/tetragon/app/tracingpolicy-*.yaml (3 files)
- claudedocs/tetragon-deployment.md

Modified:
- kubernetes/flux/meta/repos/kustomization.yaml:9
- kubernetes/apps/security/kustomization.yaml:9

## Learnings

1. **Event filtering critical**: exportDenyList must exclude system namespaces (flux, cilium, kube-system) to prevent noise
2. **eBPF requirements**: privileged + hostNetwork mandatory for kernel access
3. **Start observability mode**: action: Post (not Sigkill) to tune before enforcement
4. **Home-lab optimization**: 128-512Mi memory based on Phase 1 research
5. **ServiceMonitor labels**: Must override with `prometheus.io/operator: kube-prometheus-stack`
6. **Cilium repo**: Cluster didn't have it despite CNI - had to create

## Post-Mortem

### What Worked
- Structured phases prevented scope creep
- Phase 1 research informed Phase 4 configuration
- Minimal 3 policies avoid over-engineering
- Documentation-first captured troubleshooting while fresh

### What Failed
- Assumed Cilium repo existed - had to create it
- Tempted to create 10+ policies - resisted, started minimal

### Key Decisions
1. Observability mode first (Post not Sigkill) - tune before enforcement
2. Three policies only - cover 80% of threats with less noise
3. Exclude system namespaces - reduce legitimate event volume
4. Defer VictoriaLogs to Phase 5 - separate concern

## Artifacts

Deployment:
- kubernetes/flux/meta/repos/cilium.yaml
- kubernetes/apps/security/tetragon/ (all files)

Documentation:
- claudedocs/tetragon-deployment.md

## Action Items & Next Steps

Immediate:
1. Review files
2. Commit to Git
3. Push (trigger Flux)
4. Monitor: `kubectl get pods -n security --context home --watch`

Testing:
1. Verify pods Running on all nodes
2. Check: `kubectl get tracingpolicy -n security --context home`
3. Test events: `kubectl exec <pod> -- cat /etc/shadow`
4. Check metrics: `kubectl get servicemonitor -n security --context home`

Phase 5 (After Testing):
- Choose log forwarder for VictoriaLogs
- Create PrometheusRules for alerts
- Configure Alertmanager → Discord
- Assess Wazuh migration

## Other Notes

Architecture:
- DaemonSet with privileged + hostNetwork
- Events: stdout + file + Prometheus:2112
- Cluster context: ALWAYS `--context home`

Commit suggestion:
```
feat(security): deploy Tetragon v1.6.0 runtime security

Phase 4 of platform-evolution project
```
